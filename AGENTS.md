# エージェントへの指示書 (AGENTS.md)

## プロジェクト概要

Tab CounterはChrome拡張機能で、現在開いているタブ数を表示・追跡します。DenoとTypeScriptを使用して開発されており、Manifest V3に準拠しています。

## 基本的なこと

- **言語**: やりとりはすべて日本語でお願いします。
- **スタイル**: 既存のコードのスタイルや規約に合わせて実装してください。
- **技術スタック**: Deno + TypeScript + Chrome Extension API

## 開発プロセス

### テスト
- コードを追加・変更した場合は、必ず関連するテストを実行してください (`deno task test`)
- テストが存在しない場合は、追加を検討してください
- Chrome APIのモックを適切に使用してテストを作成してください

### ビルドとリント
- 変更後は必ずリントとフォーマットを実行: `deno task lint && deno task fmt`
- ビルドコマンド: `deno task build`
- 全てのチェック: `deno task all`

### 質問
- 不明な点や判断に迷うことがあれば、遠慮なく質問してください
- Chrome拡張機能特有の制約や仕様について不安があれば確認してください

## 開発スタイル

### TDD (テスト駆動開発)
- **Red**: 失敗するテストを書く
- **Green**: テストを通すための最小限のコードを書く
- **Refactor**: コードを改善する
- t_wadaさんの提唱するTDDサイクルを実践してください

### YAGNI原則
- "You Ain't Gonna Need It" (YAGNI)の原則に従い、現時点で不要な機能は実装しないでください
- 現在の要件に集中し、過度な汎用化は避けてください

### Baby Steps
- 小さなステップで開発を進め、こまめにフィードバックを求めてください
- 変更は最小限に抑え、動作を確認しながら進めてください

### ペアプログラミング
- この対話を通じて、ペアプログラミング形式で開発を進めましょう
- コードレビューの観点から、変更内容について議論しましょう

## プロジェクト固有のガイドライン

### Chrome拡張機能の特徴
- Manifest V3に準拠したservice workerを使用
- `chrome.tabs`と`chrome.storage` APIを活用
- 非同期処理の適切な処理が重要

### データ構造の理解
- `DailyStats`: 日次統計（最高・最低タブ数）
- `StorageData`: ストレージに保存されるデータ構造
- 日付は'sv-SE'フォーマット（ISO形式）を使用

### バッジ色の仕様
- **緑**: 良い状態（5タブ以下、前日より改善、当日最低値以下）
- **赤**: 警告状態（多すぎるタブ数）

### コードの場所と役割
- `background.ts`: サービスワーカー（タブ数監視・統計更新）
- `popup.ts`: ポップアップUI制御
- `types.ts`: TypeScript型定義
- `*_test.ts`: テストファイル
- `build.ts`: カスタムビルドスクリプト
- `popup.html/css`: ポップアップのUI構造とスタイル

### 開発時の注意点

#### Chrome拡張機能API
- 非同期処理には適切にPromiseまたはasync/awaitを使用
- `chrome.storage.local`の変更通知を適切に処理
- `chrome.tabs.query()`などのAPIの制限を理解して使用

#### UI開発
- ポップアップのサイズは220px幅を基準とする
- 日本語フォント（Meiryo）を考慮したレイアウト
- アクセシビリティを意識したHTML構造

#### エラーハンドリング
- Chrome APIのエラーを適切にキャッチ
- ストレージの読み取り/書き込みエラーに対処
- UI要素が存在しない場合の安全な処理

### よくある作業パターン

#### 新機能追加の流れ
1. `types.ts`で必要な型を定義
2. テストファイルで期待動作を記述
3. 実装コードを追加
4. ビルド・テスト・リントを実行
5. 手動でChrome拡張機能として動作確認

#### バグ修正の流れ
1. 再現可能なテストケースを作成
2. 問題箇所を特定・修正
3. テストが通ることを確認
4. 回帰テストを実行
